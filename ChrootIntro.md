#Использование chroot.

# Введение #
Накопитель WD My Book Live прекрасно справляется с основными задачами сетевого хранилища (SAMBA/NFS/AFP). Но, к сожалению, производитель из дополнительных возможностей предоставил только медиасервер (проприетарные Twonky Media 5 или WD Media Server на выбор).

В то же время, аппаратная начинка (800 МГц, 256 Мбайт ОЗУ) устройства, почти полноценный linux-дистрибутив Debian на борту и доступность ssh так и просятся для проведения экспериментов по расширению функциональности устройства.

Основная и главная проблема - WD разрабатывает прошивку на базе Debian GNU/Linux 5 "Lenny". Данная система устарела и не поддерживается большинством разработчиков, обновить и установить нужные пакеты трудно или практически невозможно.

Наиболее распространенные методы расширения функционала через пакетные установщики Debian (apt-get) либо Optware (ipkg) влекут за собой ряд рисков и могут приводить к выходу устройства из строя (окирпичиванию):
  * Требуемые пакеты расширения работают только на устаревших стоковых прошивках и становятся неработоспособными при обновлениях.
  * При неправильной конфигурации установленные пакеты могут не лимитированно использовать корневую файловую систему (например для логирования, создания базы данных, создания временных файлов, и т.д.) и тем самым забивать и так ограниченное место.
  * При обновлении стоковой прошивки добавления будут утеряны, и потребуют установки с нуля.

Предлагаемый здесь метод позволяет избежать все описанные выше риски. Он основан на использовании [механизма chroot](http://ru.wikipedia.org/wiki/Chroot) - операции изменения корневого каталога. Программы, запущенные с изменённым корневым каталогом, будут иметь доступ только к файлам, содержащимся в данном каталоге и не смогут обращаться к файлам вне каталога.

Суть метода - Установка полноценного Debian Wheezy в chroot вне корневого каталога (по умолчанию в `/DataVolume/debian/`), добавление и настройка в нем требуемых пакетов, а так же автоматический запуск нужных сервисов из chroot при запуске устройства и легкое восстановление работоспособности при обновлениях стоковой прошивки.

  * [Здесь](http://code.google.com/p/mbl-common/wiki/ChrootInstallation) описана установка chroot-среды.

  * [Здесь](http://code.google.com/p/mbl-common/wiki/ChrootUsing) приведена базовая информация по её использованию.